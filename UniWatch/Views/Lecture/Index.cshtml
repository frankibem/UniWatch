@using UniWatch.Models
@model IEnumerable<Lecture>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>@ViewBag.Title</h2>
<hr />

@{
    @Html.ActionLink("New Lecture", "Create", "Lecture", new { classId = Request.QueryString["classId"] }, null)

    if (!Model.Any())
    {
        <h4>There are no lectures for this class</h4>
    }
    else
    {
        var lectures = Model.OrderByDescending(lecture => lecture.RecordDate);

        <table class="table table-striped">
            <thead>
            <tr>
                <th>Student</th>

                @foreach (var lecture in lectures)
                {
                    <th class="text-center">
                        @Html.ActionLink(
                            lecture.RecordDate.ToShortDateString(),
                            "Override",
                            "Lecture",
                            new
                            {
                                lectureId = lecture.Id
                            },
                            null
                            )
                    </th>
                }
            </tr>
            </thead>
            <tbody>
            @foreach (Student student in ViewBag.Students)
            {
                <tr>
                    <td>@string.Format($"{student.FirstName} {student.LastName}")</td>
                    
                    @foreach (var lecture in lectures)
                    {
                        var isPresent = lecture.Attendance.
                            SingleOrDefault(a => a.Student.Id == student.Id && a.Lecture.Id == lecture.Id)?
                            .Present ?? false;

                        <td class="text-center">
                            @if (isPresent)
                            {
                                <span class="glyphicon glyphicon-ok" style="color: green;"></span>
                            }
                            else
                            {
                                <span class="glyphicon glyphicon-remove" style="color: red;"></span>
                            }
                        </td>
                    }
                </tr>  
            }
            </tbody>
        </table>
    }
}